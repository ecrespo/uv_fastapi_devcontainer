# uv_fastapi_devcontainer


1. Install uv package manager

```bash
pipx install uv 
```

2. Inicializando el entorno
```bash
uv init . 
```
3. Crea el archivo pyproject.toml

```
[project]
name = "uv-fastapi-devcontainer"
version = "0.1.0"
description = "Add your description here"
readme = "README.md"
requires-python = ">=3.12"
dependencies = []
```


4. Crear un entorno .venv
```
uv venv
Using Python 3.12.3 interpreter at: /usr/bin/python3.12
Creating virtual environment at: .venv
Activate with: source .venv/bin/activate
```

5. Activar  el entorno:
```aiignore
source .venv/bin/activate
```

6. . INstalar uvicorn y fastapi

```bash 
uv add fastapi uvicorn
```

Esto genera el archivo uv.lock 

Y ahora el archivo pyproject.toml contiene los paquetes:
```aiignore

[project]
name = "uv-fastapi-devcontainer"
version = "0.1.0"
description = "Add your description here"
readme = "README.md"
requires-python = ">=3.12"
dependencies = [
    "fastapi>=0.115.0",
    "uvicorn>=0.30.6",
]

```

7. Se puede generar un archivo requirements.txt a partir del pyproject.toml

```aiignore
uv pip compile pyproject.toml -o requirements.txt
Resolved 12 packages in 602ms
# This file was autogenerated by uv via the following command:
#    uv pip compile pyproject.toml -o requirements.txt
annotated-types==0.7.0
    # via pydantic
anyio==4.6.0
    # via starlette
click==8.1.7
    # via uvicorn
fastapi==0.115.0
    # via uv-fastapi-devcontainer (pyproject.toml)
h11==0.14.0
    # via uvicorn
idna==3.10
    # via anyio
pydantic==2.9.2
    # via fastapi
pydantic-core==2.23.4
    # via pydantic
sniffio==1.3.1
    # via anyio
starlette==0.38.5
    # via fastapi
typing-extensions==4.12.2
    # via
    #   fastapi
    #   pydantic
    #   pydantic-core
uvicorn==0.30.6
    # via uv-fastapi-devcontainer (pyproject.toml)
```
8. Probar que el entorno se ejecuta

```bash 
uv run python3 run.py 
Installed 12 packages in 13ms
INFO:     Will watch for changes in these directories: ['/home/ernesto/PycharmProjects/uv_fastapi_devcontainer']
WARNING:  "workers" flag is ignored when reloading is enabled.
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [27866] using StatReload
INFO:     Started server process [27871]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
```

9. El archivo Dockerfile con soporte de uv para correr  fastapi.

```Dockerfile

# Use a Python image with uv pre-installed
FROM ghcr.io/astral-sh/uv:python3.12-bookworm

RUN apt-get update -qq && apt-get install -y --no-install-recommends --no-install-suggests \
    build-essential \
    libpq-dev \
    libssl-dev \
    libffi-dev \
    python3-dev \
    python3-pip \
    python3-setuptools \
    unzip \
    python3-wheel && \
    apt-get autoremove -y && apt-get clean && rm -rf /var/lib/apt/lists/*

# Install the project into `/app`
WORKDIR /app

# Enable bytecode compilation
ENV UV_COMPILE_BYTECODE=1

# Copy from the cache instead of linking since it's a mounted volume
ENV UV_LINK_MODE=copy

# Install the project's dependencies using the lockfile and settings
RUN --mount=type=cache,target=/root/.cache/uv \
    --mount=type=bind,source=uv.lock,target=uv.lock \
    --mount=type=bind,source=pyproject.toml,target=pyproject.toml \
    uv sync --frozen --no-install-project --no-dev

# Then, add the rest of the project source code and install it
ADD . /app
RUN --mount=type=cache,target=/root/.cache/uv \
    uv sync --frozen --no-dev

# Place executables in the environment at the front of the path
ENV PATH="/app/.venv/bin:$PATH"

# Reset the entrypoint, don't invoke `uv`
ENTRYPOINT []

ENV PATH="/app/.venv/bin:/usr/local/bin:/usr/bin:/bin:$PATH"
ENV NODE_PATH="/usr/lib/node_modules"

# Run the FastAPI application by default
# Uses `fastapi dev` to enable hot-reloading when the `watch` sync occurs
# Uses `--host 0.0.0.0` to allow access from outside the container
CMD ["python3", "run.py"]

```

10. Archivo docker-compose.yaml:

```YAML

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: app
    ports:
      - "8000:8000"
    networks:
      - fastapi_api
    restart: always

networks:
  fastapi_api:
    driver: bridge
```

11. Correr el proyecto:

```bash
docker compose up --build -d
```
